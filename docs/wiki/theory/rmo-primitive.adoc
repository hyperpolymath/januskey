= RMO: Obliterative Wipe Primitive
:toc: left
:toclevels: 3
:icons: font
:source-highlighter: rouge
:stem: latexmath

== Definition

**RMO (Obliterative Wipe)** is a data primitive that guarantees, via formal proof, the non-existence (unrecoverability) of specific data after invocation. This implements GDPR Article 17 "Right to Erasure" with mathematical certainty.

[quote]
For data stem:[d] after stem:[\text{RMO}(d)], there exists no algorithm stem:[A] such that stem:[A(\text{system\_state}) = d].

== Core Properties

=== Property 1: Irrecoverability

After obliteration, the data cannot be recovered through any algorithmic means:

[stem]
++++
\nexists A: A(\Sigma', M') \to d
++++

where stem:[\Sigma'] and stem:[M'] are the post-obliteration content and metadata stores.

=== Property 2: Verifiable Deletion

Obliteration generates a cryptographic proof that can be independently verified:

[source,rust]
----
pub struct ObliterationProof {
    pub id: String,
    pub content_hash: ContentHash,
    pub timestamp: DateTime<Utc>,
    pub nonce: String,
    pub commitment: String,  // H(content_hash || nonce || timestamp)
    pub overwrite_passes: usize,
}
----

=== Property 3: Audit Trail Without Content

The fact of obliteration is logged for compliance, but the content itself is never stored in the audit log:

[source,rust]
----
pub struct ObliterationRecord {
    pub timestamp: DateTime<Utc>,
    pub user: String,
    pub content_hash: ContentHash,  // Hash only, not content
    pub reason: Option<String>,
    pub legal_basis: Option<String>,
    pub proof: ObliterationProof,
}
----

== Secure Overwrite Protocol

RMO implements a multi-pass secure overwrite based on DoD 5220.22-M standards:

=== Phase 1: Pattern Overwrite

[source,rust]
----
const OVERWRITE_PASSES: usize = 3;
const PATTERNS: [u8; 3] = [0x00, 0xFF, 0x00];

// Pass 1: Write all zeros
// Pass 2: Write all ones
// Pass 3: Random data
----

=== Phase 2: File Removal

After secure overwrite, the file is deleted from the filesystem.

=== Phase 3: Proof Generation

A cryptographic commitment is generated:

[stem]
++++
\text{commitment} = H(\text{content\_hash} \| \text{nonce} \| \text{timestamp})
++++

This allows verification that:

1. The specific content (identified by hash) was obliterated
2. Obliteration occurred at a specific time
3. The proof has not been tampered with

== CLI Commands

=== Obliterate Content

[source,bash]
----
# Obliterate by content hash
jk obliterate --hash sha256:abc123... --reason "User request" --legal-basis "GDPR Article 17"

# Obliterate content from a specific operation
jk obliterate --operation <operation-id> --reason "Data breach cleanup"
----

=== View Obliteration History

[source,bash]
----
jk obliteration-history --limit 20
----

Output:
----
Obliteration History (RMO Audit Trail)
════════════════════════════════════════════════════════════════════════════════

2025-12-17 10:30:00 UTC | OBLITERATED | sha256:abc123...
      Proof: 12345678 | User: jonathan
      Reason: User request
      Legal basis: GDPR Article 17

════════════════════════════════════════════════════════════════════════════════
Total obliterations: 1
----

=== Verify Obliteration Proof

[source,bash]
----
jk verify-obliteration <proof-id>
----

Output:
----
Obliteration Proof Verification
──────────────────────────────────────────────────

Proof ID:        abc123-def456...
Content Hash:    sha256:abc123...
Timestamp:       2025-12-17 10:30:00 UTC
User:            jonathan
Overwrite Passes: 3

Commitment:      9f86d081884c7d659a2feaa0c55ad015...
Nonce:           a3f2b8c9d0e1f2a3...

✓ Cryptographic commitment VERIFIED
  The proof cryptographically confirms that:
  • Content with hash sha256:abc123... was obliterated
  • Obliteration occurred at 2025-12-17 10:30:00
  • 3 overwrite passes were performed

✓ Content confirmed absent from store
----

== Relationship with RMR

RMR and RMO are complementary primitives in the MAA Framework:

[ditaa]
....
    +---------------+                    +---------------+
    |     RMR       |                    |     RMO       |
    | Reversibility |                    | Obliteration  |
    +-------+-------+                    +-------+-------+
            |                                    |
            |        Normal operation            |
            +------------------------------------>
            |                                    |
            |        Can undo via RMR            |
            <------------------------------------+
            |                                    |
            |        GDPR erasure request        |
            +------------------------------------>
            |                                    |
            |        After RMO: NO undo          |
            |        Content unrecoverable       |
            |                                    |
    +-------+-------+                    +-------+-------+
    | Accountability|                    |   Autonomy    |
    +---------------+                    +---------------+
....

=== Key Differences

|===
| Aspect | RMR | RMO

| Purpose
| Track and reverse changes
| Permanently erase data

| Reversibility
| Always reversible
| Never reversible

| Content storage
| Preserves original content
| Destroys original content

| Audit
| Full operation details
| Fact of deletion only

| Legal basis
| Accountability
| Right to Erasure
|===

== GDPR Compliance

RMO directly supports GDPR Article 17 "Right to Erasure":

=== Article 17 Requirements

[quote, GDPR Article 17]
The data subject shall have the right to obtain from the controller the erasure of personal data concerning him or her without undue delay.

=== How RMO Complies

|===
| GDPR Requirement | RMO Implementation

| Erasure without undue delay
| Immediate secure overwrite

| Verification of erasure
| Cryptographic obliteration proof

| Record of erasure
| Audit log with timestamp, user, legal basis

| No retention of erased data
| Proof contains only hash, not content
|===

== Formal Verification

=== Theorem: Formal Obliteration

After stem:[\text{RMO}(h)] for content hash stem:[h]:

[stem]
++++
\Sigma(h) = \bot \land \text{proof\_valid}(h)
++++

The content is removed from the store and a valid proof exists.

=== Proof

1. **Secure Overwrite**: Content at path derived from stem:[h] is overwritten with patterns
2. **File Removal**: Path is deleted from filesystem
3. **Proof Generation**: Commitment stem:[H(h \| n \| t)] is computed
4. **Store Update**: stem:[\Sigma(h) := \bot]

By the irreversibility of secure overwrite and the collision resistance of SHA256, the content is unrecoverable. ∎

== Implementation

[source,rust]
----
impl ObliterationManager {
    pub fn obliterate(
        &mut self,
        content_store: &ContentStore,
        content_hash: &ContentHash,
        reason: Option<String>,
        legal_basis: Option<String>,
    ) -> Result<ObliterationRecord> {
        // Get content path
        let content_path = content_store.content_path(content_hash);

        // Perform secure overwrite
        let passes = secure_overwrite(&content_path)?;

        // Remove file
        fs::remove_file(&content_path)?;

        // Generate proof
        let proof = ObliterationProof::generate(content_hash, passes);

        // Create audit record
        let record = ObliterationRecord {
            id: Uuid::new_v4().to_string(),
            timestamp: Utc::now(),
            user: whoami::username(),
            content_hash: content_hash.clone(),
            reason,
            legal_basis,
            proof,
            cleaned_operation_ids: Vec::new(),
        };

        // Log for audit
        self.log.records.push(record.clone());
        self.save()?;

        Ok(record)
    }
}
----

== Security Considerations

=== Secure Overwrite Limitations

* Does not guarantee erasure from SSDs with wear leveling
* May not erase data from filesystem journal
* Cloud storage may retain backups

For maximum security:

1. Use encrypted storage where possible
2. Consider physical destruction for highly sensitive data
3. Verify with specialized forensic tools

=== Proof Tamper Resistance

The cryptographic commitment prevents:

* Backdating obliteration claims
* Claiming obliteration of different content
* Modifying the proof after generation

== Further Reading

* link:rmr-primitive.adoc[RMR: Reversible Transaction Primitive]
* link:maa-framework.adoc[MAA Framework Overview]
* link:../guides/cli.adoc[CLI Commands Guide]
